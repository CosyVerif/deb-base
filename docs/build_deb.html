<!DOCTYPE html>

<html>
<head>
  <title>build_deb.sh</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>build_deb.sh</h1>
        

        
      </div>

      
        
        <h2 id="how-to-use-this-script">How To Use This Script</h2>

        
      
        
        
        
      
        
        <p>The purpose of this script is to create Debian packages. As you may know
there are differents types of packages. This script allows you to create two
differents type of packages. The first one is the binary package which contains
binary files. The other one is the library package. When you want to create 
a library package, two packages are actually created. Here is a quick
description of those : </p>
<ol>
<li>&lt;package_name&gt;_&lt;version&gt;.deb : This is the package containing
the libraries.</li>
<li>&lt;package_name&gt;-dev_&lt;version&gt; : This package will contain the
header files.</li>
</ol>

        
      
        
        <p>In order for this script to work correctly, some scripts and files are needed. 
Thoses files can be found in the same repository where you’ve found this
one. Here is a list of them :</p>
<ol>
<li>build_config.yml : This file contains all the informations this script
need to build the Debian packages you want. <span class='gras'>You must
read it, and fill it with correct informations.</span></li>
<li>config_parser.pl : This perl script parses the configuration file (see 
above), and produces an output that look something like “export NAME=VALUE;”.</li>
<li>correct_lintian.pl : Perl script that correct some of the mistakes that
lintian (command that check the conformity of packages) detects. Although this
script is not necessary to produce a package, it’s highly recommended
to have it, in order to build a package that complies with the Debian Policy.</li>
<li>Your project needs a makefile if you want to build a binary package. Debian
tools need one to create binaries, in order to include them into the package.</li>
</ol>

        
      
        
        <h2 id="how-this-script-works">How this script works</h2>

        
      
        
        
        
      
        
        <p>Here are the main steps of the script :</p>
<ol>
<li><a href='#conf'>Reading the configuration file</a></li>
<li><a href='#makefile'>Looking for the Makefile</a></li>
<li><a href='#tarball'>Creating Tarballs</a></li>
<li><a href='#copyright'>The copyright file</a></li>
<li><a href='#lib'>Building the library packages</a><ol>
<li><a href='#libdeb'>Creation of the Debian files</a></li>
<li><a href='#libmod'>Modification of the Debial files</a></li>
<li><a href='#libsource'>Creation of the source package</a></li>
<li><a href='#libbuild'> Building the package</a></li>
</ol>
</li>
<li><a href='#bin'>Building the binary package</a><ol>
<li><a href='#bindeb'>Creation of the Debian files</a></li>
<li><a href='#binmod'>Modification of the Debial files</a></li>
<li><a href='#binsource'>Creation of the source package</a></li>
<li><a href='#binbuild'> Building the package</a></li>
</ol>
</li>
</ol>

        
      
        
        <h2 id="-a-id-conf-reading-configuration-file-a-"><a id='conf'>Reading configuration file.</a></h2>

        
      
        
        
        
      
        
        <p>In order for this script to run correctly, you need to complete the file named
‘<em>build_config.yml</em>‘. This file defines a certain number of variable (like the
name of the packages, the version of the program, and so on …) that this
script will then use to build the packages the user want. <span class='gras'>
The configuration file MUST be in the same directory as this script.</span></p>

        
      
        
        <p>So, firstly, we check if there’s a configuration file. If there isn’t
any, we exit the script.</p>

        
          <div class='highlight'><pre>
<span class="hljs-keyword">if</span> [ ! <span class="hljs-operator">-f</span> <span class="hljs-string">"build_config.yml"</span> ] 
<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"build_config.yml is missing"</span> &gt;&amp;<span class="hljs-number">2</span>
    <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">fi</span></pre></div>
        
      
        
        <p>Same for the script <em>config_parser.pl</em>.</p>

        
          <div class='highlight'><pre>
<span class="hljs-keyword">if</span> [ ! <span class="hljs-operator">-f</span> <span class="hljs-string">"config_parser.pl"</span> ] 
<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"config_parser.pl is missing"</span> &gt;&amp;<span class="hljs-number">2</span>
    <span class="hljs-keyword">exit</span> <span class="hljs-number">2</span>;
<span class="hljs-keyword">fi</span></pre></div>
        
      
        
        <p>Then, we parse the configuration file. This is done by the perl script 
<em>config_parser.pl</em>. This script must also be in the same directory as this
script. This works because the script that parses the file produces an output
that looks like “export NAME=VALUE;”, which is actually shell commands that
can be passed to the shell command eval.</p>

        
          <div class='highlight'><pre>
<span class="hljs-built_in">eval</span> `./config_parser.pl build_config.yml`;</pre></div>
        
      
        
        <h2 id="-a-id-makefile-looking-for-the-makefile-a-"><a id='makefile'>Looking for the Makefile</a></h2>

        
      
        
        
        
      
        
        <p>Here, we are checking the presence of a Makefile.
If there is no Makefile, the script quits immediatly.
Debian tools need that in order to build your program.</p>

        
          <div class='highlight'><pre>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$DIRECTORYNAME</span>;
<span class="hljs-keyword">if</span> [ ! <span class="hljs-operator">-f</span> Makefile ] 
<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Makefile is missing"</span> &gt;&amp;<span class="hljs-number">2</span>
    <span class="hljs-keyword">exit</span> <span class="hljs-number">3</span>;
<span class="hljs-keyword">fi</span></pre></div>
        
      
        
        <h2 id="-a-id-tarball-creating-tarballs-a-"><a id='tarball'>Creating Tarballs</a></h2>

        
      
        
        
        
      
        
        <p>We check if the user wants to build a library package by looking 
at the PACKAGETYPE variable. If there is a “l” in this string, it means that 
the user want to build a library package. To do so, we have to create an 
adequately named tarball. In order to be adequatly named, a tarball must 
have a name that matches the following pattern : 
&lt;package_name&gt;_&lt;version&gt;.orig.tar.gz.</p>

        
      
        
        <p><span class='gras'>N.B. :</span> package_name must be the name of the 
library package you want to build.</p>

        
      
        
        <p>In the same way, if there is a “s” in PACKAGETYPE, it means that we 
have to create a binary package. We must also create a tarball that is named
adequately (i.e. it must follow the previous pattern).</p>

        
          <div class='highlight'><pre>
<span class="hljs-keyword">for</span> var <span class="hljs-keyword">in</span> <span class="hljs-variable">$PACKAGETYPE</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$var</span> = <span class="hljs-string">"l"</span> ]
    <span class="hljs-keyword">then</span>
	LIBTARBALL=<span class="hljs-string">"<span class="hljs-variable">$LIBPACKAGENAME</span>"</span><span class="hljs-string">"_<span class="hljs-variable">$VERSION</span>.orig.tar.gz"</span>;
	tar czf <span class="hljs-string">"<span class="hljs-variable">$LIBTARBALL</span>"</span> .;
	mv <span class="hljs-variable">$LIBTARBALL</span> ..
    <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$var</span> = <span class="hljs-string">"s"</span> ]
    <span class="hljs-keyword">then</span>
	BINTARBALL=<span class="hljs-string">"<span class="hljs-variable">$BINPACKAGENAME</span>"</span><span class="hljs-string">"_<span class="hljs-variable">$VERSION</span>.orig.tar.gz"</span>;
	tar czf <span class="hljs-string">"<span class="hljs-variable">$BINTARBALL</span>"</span> .;
	mv <span class="hljs-variable">$BINTARBALL</span> ..
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>;</pre></div>
        
      
        
        <h2 id="-a-id-copyright-the-copyright-file-a-"><a id='copyright'>The copyright file</a></h2>

        
      
        
        
        
      
        
        <p>The Debian Policy tells us that there need to be a file named ‘<em>copyright</em>‘
in the debian directory. Although this is not mandatory, it’s recommended to
do so, if you want your package to be compliant with the Debian Policy. There’s
a variable concerning this in the configuration file.</p>

        
      
        
        <p>In this part of the script, we check if the variable COPYRIGHT is empty, a file
the user wants to include or a predefined value.</p>

        
          <div class='highlight'><pre> 
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$COPYRIGHT</span> = <span class="hljs-string">"gpl"</span> ] || [ <span class="hljs-variable">$COPYRIGHT</span> = <span class="hljs-string">"gpl2"</span> ] || [ <span class="hljs-variable">$COPYRIGHT</span> = <span class="hljs-string">"gpl3"</span> ]\
    || [ <span class="hljs-variable">$COPYRIGHT</span> = <span class="hljs-string">"lgpl"</span> ] || [ <span class="hljs-variable">$COPYRIGHT</span> = <span class="hljs-string">"lgpl2"</span> ] \
    || [ <span class="hljs-variable">$COPYRIGHT</span> = <span class="hljs-string">"lgpl3"</span> ] || [ <span class="hljs-variable">$COPYRIGHT</span> = <span class="hljs-string">"artistic"</span> ] || \
    [ <span class="hljs-variable">$COPYRIGHT</span> = <span class="hljs-string">"apache"</span> ] || [ <span class="hljs-variable">$COPYRIGHT</span> = <span class="hljs-string">"bsd"</span> ] || \
    [ <span class="hljs-variable">$COPYRIGHT</span> = <span class="hljs-string">"mit"</span> ]
<span class="hljs-keyword">then</span>
    COPYRIGHTTYPE=predefined;
<span class="hljs-keyword">elif</span> [ <span class="hljs-operator">-f</span> <span class="hljs-variable">$COPYRIGHT</span> ]
<span class="hljs-keyword">then</span>
    COPYRIGHTTYPE=file;
<span class="hljs-keyword">else</span>
    COPYRIGHTTYPE=empty;
<span class="hljs-keyword">fi</span></pre></div>
        
      
        
        <h2 id="-a-id-lib-building-the-library-packages-a-"><a id='lib'>Building the library packages</a></h2>

        
      
        
        
        
      
        
        <p>This is the part of the script where we’re going to build the packages that
will contain the library and the header files. This is also where we’re
going to build the binary package, if it happens that the user wants to build
both type of packages. Indeed, if the user wants to build both type of packages
, it is much simpler to do it in this part of the script, because this is
where there are less modification to do in the debian files.</p>

        
          <div class='highlight'><pre>
<span class="hljs-keyword">if</span> [ ! -z <span class="hljs-variable">$LIBTARBALL</span> ]
<span class="hljs-keyword">then</span></pre></div>
        
      
        
        <h2 id="-a-id-libdeb-creation-of-the-debian-files-a-"><a id='libdeb'>Creation of the Debian files</a></h2>

        
      
        
        
        
      
        
        <p>In order to build packages, debuild (the utilitary that will create the 
package) needs some files that must be put in a directory 
named <em>debian</em>, in the source code directory (variable DIRECTORYNAME in 
the configuration file).</p>

        
      
        
        <p>The files that debuild needs can be created automatically by the command 
dh_make. We call dh_make with those options :</p>
<ol>
<li>-l : It means that we want to create library packages.</li>
<li>-c : It tells dh_make we want a pre-filled copyright file.</li>
<li>-p : Forces the package name to be what is after that option. It’s quite
usefull because dh_make normally checks if the source code directory is named
according to the following pattern : &lt;packagename&gt;-&lt;version&gt;. 
This option allows you to name your directory whatever name you want.</li>
</ol>

        
      
        
        <p>We remove de debian directory, because if there is one, dh_make will not make
any changes, and that’s not what we want.</p>

        
          <div class='highlight'><pre>    rm -rf debian/</pre></div>
        
      
        
        <p>We create a temporary file that only contains a blank line. We do that because
dh_make waits an input from the user</p>

        
          <div class='highlight'><pre>    env <span class="hljs-built_in">echo</span> <span class="hljs-operator">-e</span> -n <span class="hljs-string">"\n"</span> &gt; debtmpfile</pre></div>
        
      
        
        <p>We use the -c option of dh_make if the user specified that the copyright file
must be generated by dh_make. You shouldn’t really do that because the
copright files that are generated by dh_make needs to be filled with
correct information</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$COPYRIGHTTYPE</span> = <span class="hljs-string">"predefined"</span> ]
    <span class="hljs-keyword">then</span>
	dh_make <span class="hljs-operator">-l</span> -c <span class="hljs-variable">$COPYRIGHT</span> -p <span class="hljs-string">"<span class="hljs-variable">$LIBPACKAGENAME</span>"</span><span class="hljs-string">"_<span class="hljs-variable">$VERSION</span>"</span> &lt; debtmpfile
    <span class="hljs-keyword">else</span>
	dh_make <span class="hljs-operator">-l</span> -p <span class="hljs-string">"<span class="hljs-variable">$LIBPACKAGENAME</span>"</span><span class="hljs-string">"_<span class="hljs-variable">$VERSION</span>"</span> &lt; debtmpfile
    <span class="hljs-keyword">fi</span></pre></div>
        
      
        
        <p>If the user has written a copyright file, we copy it in the debian directory</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$COPYRIGHTTYPE</span> = <span class="hljs-string">"file"</span> ] 
    <span class="hljs-keyword">then</span>
	cp <span class="hljs-variable">$COPYRIGHT</span> debian/copyright
    <span class="hljs-keyword">fi</span></pre></div>
        
      
        
        <p>We then remove the temporary file we have created.</p>

        
          <div class='highlight'><pre>    rm <span class="hljs-operator">-f</span> debtmpfile</pre></div>
        
      
        
        <h2 id="-a-id-libmod-modification-of-the-debian-files-a-"><a id='libmod'>Modification of the debian files</a></h2>

        
      
        
        
        
      
        
        <p>dh_make creates the debian directory, and all the files in it. Therefore, we
must modify some of them, because some of them are not complete.</p>

        
      
        
        <p>First, we need to modify the changelog file, because if we don’t, the name
of the package will be something like : &lt;packagename&gt;_&lt;version&gt;-1
_&lt;archi&gt;.deb.    This is not what we want. We want something like :
&lt;packagename&gt;_&lt;version&gt;_&lt;archi&gt;.deb.</p>

        
          <div class='highlight'><pre>
    perl -pi <span class="hljs-operator">-e</span> <span class="hljs-string">'s/\(((\d+\.?)+)-\d+\)/($1)/'</span> debian/changelog</pre></div>
        
      
        
        <p>Some of the files generated by dh_make are just examples of what you should 
provide. This is not interesting to us, therefore we have to suppress them.</p>

        
          <div class='highlight'><pre>
    rm -rf debian/*.EX debian/*.ex debian/README*</pre></div>
        
      
        
        <p>We then have to rename the dirs files and the install files that have been
created by dh_make. .dirs files tells <em>debuild</em> what are the directories
that must created in the package(s). .install files tells the <em>debuild</em> 
command what files must be put in the package(s). You can create up to one
.dirs file and one .install file for each package you want to build.
We need to rename those files because the generated files are named according
to those patterns : &lt;packagename&gt;1.dirs and &lt;packagename&gt;1.install
. This is not 
correct, because those files must be named after the package name. Thus, 
we must rename them according to the following pattern : 
&lt;packagename&gt;.dirs and &lt;packagename&gt;.install.</p>

        
          <div class='highlight'><pre>
    mv debian/<span class="hljs-string">"<span class="hljs-variable">$LIBPACKAGENAME</span>"</span><span class="hljs-number">1</span>.dirs debian/<span class="hljs-string">"<span class="hljs-variable">$LIBPACKAGENAME</span>"</span>.dirs
    mv debian/<span class="hljs-string">"<span class="hljs-variable">$LIBPACKAGENAME</span>"</span><span class="hljs-number">1</span>.install debian/<span class="hljs-string">"<span class="hljs-variable">$LIBPACKAGENAME</span>"</span>.install</pre></div>
        
      
        
        <p>In the control file, the name of the package is &lt;packagename&gt;BROKEN.
This is not the package name we want, we must therefore change it to
&lt;packagename&gt;.</p>

        
          <div class='highlight'><pre>
    sed -i -r <span class="hljs-operator">-e</span> s/<span class="hljs-string">"<span class="hljs-variable">$LIBPACKAGENAME</span>"</span>BROKEN/<span class="hljs-string">"<span class="hljs-variable">$LIBPACKAGENAME</span>"</span>/g debian/control</pre></div>
        
      
        
        <p>Then, we have to fill the .install and .dirs files with correct information.
In order to do that, we use the variables LIBNAMES (which contains the
libraries you want to include in the package) and HEADERNAMES (which contains
the name of the header files you want to include in the package).</p>

        
          <div class='highlight'><pre>
    rm <span class="hljs-operator">-f</span> debian/<span class="hljs-variable">$LIBPACKAGENAME</span>.install
    <span class="hljs-keyword">for</span> library <span class="hljs-keyword">in</span> <span class="hljs-variable">$LIBNAMES</span>
    <span class="hljs-keyword">do</span>
	<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$library</span> usr/lib"</span> &gt;&gt; debian/<span class="hljs-variable">$LIBPACKAGENAME</span>.install
    <span class="hljs-keyword">done</span>;

    rm <span class="hljs-operator">-f</span> debian/<span class="hljs-variable">$LIBPACKAGENAME</span>-dev.install;
    <span class="hljs-keyword">for</span> header <span class="hljs-keyword">in</span> <span class="hljs-variable">$HEADERNAMES</span>
    <span class="hljs-keyword">do</span>
	<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$header</span> usr/include/"</span> &gt;&gt; debian/<span class="hljs-variable">$LIBPACKAGENAME</span>-dev.install
    <span class="hljs-keyword">done</span>;</pre></div>
        
      
        
        <p>If the user wants to build both types of packages, we create a .install file
and a .dirs file containing the right informations. </p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> [ ! -z <span class="hljs-variable">$BINTARBALL</span> ] 
    <span class="hljs-keyword">then</span>

	<span class="hljs-keyword">for</span> binary <span class="hljs-keyword">in</span> <span class="hljs-variable">$BINARYNAMES</span>
	<span class="hljs-keyword">do</span>
	    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$binary</span> usr/bin"</span> &gt;&gt; debian/<span class="hljs-variable">$BINPACKAGENAME</span>.install
	<span class="hljs-keyword">done</span>;
	<span class="hljs-built_in">echo</span> <span class="hljs-string">"usr/bin"</span> &gt;&gt; debian/<span class="hljs-variable">$BINPACKAGENAME</span>.dirs</pre></div>
        
      
        
        <p>We then have to add information in the control file. We have to tell <em>debuild</em>
that there’s another package to create.</p>

        
          <div class='highlight'><pre>
	env <span class="hljs-built_in">echo</span> <span class="hljs-operator">-e</span> -n <span class="hljs-string">"\n"</span> &gt;&gt; debian/control
	<span class="hljs-built_in">echo</span> <span class="hljs-string">"Package: <span class="hljs-variable">$BINPACKAGENAME</span>"</span> &gt;&gt; debian/control
	<span class="hljs-built_in">echo</span> <span class="hljs-string">"Architecture: any"</span> &gt;&gt; debian/control
	<span class="hljs-built_in">echo</span> <span class="hljs-string">'Depends: ${shlibs:Depends}, ${misc:Depends}'</span> &gt;&gt; debian/control
	<span class="hljs-built_in">echo</span> <span class="hljs-string">'Description: &lt;insert up to 60 chars description&gt;'</span> &gt;&gt;debian/control
	<span class="hljs-built_in">echo</span> <span class="hljs-string">' &lt;insert long description, indented with spaces&gt;'</span> &gt;&gt;debian/control
    <span class="hljs-keyword">fi</span></pre></div>
        
      
        
        <p>Now, we have to add the dependencies of the packages, in the control file.</p>

        
          <div class='highlight'><pre>
    <span class="hljs-keyword">if</span> [ ! -z <span class="hljs-variable">$PACKAGEDEPENDS</span> ]
    <span class="hljs-keyword">then</span>
	perl -pi <span class="hljs-operator">-e</span> <span class="hljs-string">'s/^(Depends:.+)$/$1, '</span><span class="hljs-string">"<span class="hljs-variable">$PACKAGEDEPENDS</span>/"</span> debian/control 
    <span class="hljs-keyword">fi</span>   
    <span class="hljs-keyword">if</span> [ ! -z <span class="hljs-variable">$BUILDDEPENDS</span> ]
    <span class="hljs-keyword">then</span>
	perl -pi <span class="hljs-operator">-e</span> <span class="hljs-string">'s/^(Build-Depends:.+)$/$1, '</span><span class="hljs-string">"<span class="hljs-variable">$BUILDDEPENDS</span>/"</span> debian/control
    <span class="hljs-keyword">fi</span></pre></div>
        
      
        
        <h2 id="-a-id-libsource-creation-of-the-source-package-a-"><a id='libsource'>Creation of the source package</a></h2>

        
      
        
        
        
      
        
        <p>Now, we are building a source package that contains the source code 
of your program. When debuild has created that package, it runs a program 
called <em>lintian</em>, that checks if the package complies with the debian policy.
The log of this run can be found in the file whose name matches the following
pattern : &lt;packagename&gt;_&lt;version&gt;_source.build. Some of the
errors detected by <em>lintian</em> can be corrected automatically. This is why we’ve
created a script called <em>correct_lintian.pl</em>, that corrects some of thoses
errors. </p>

        
          <div class='highlight'><pre>
    debuild -S -uc -us
    ../correct_lintian.pl  ../<span class="hljs-string">"<span class="hljs-variable">$LIBPACKAGENAME</span>"</span><span class="hljs-string">"_<span class="hljs-variable">$VERSION</span>"</span><span class="hljs-string">"_source.build"</span></pre></div>
        
      
        
        <h2 id="-a-id-libbuild-building-the-package-a-"><a id='libbuild'>Building the package</a></h2>

        
      
        
        
        
      
        
        <p>Now, we can finally build the package. <em>debuild</em> does pretty much all the work.
-us and -uc options means that we don’t sign the packages.</p>

        
          <div class='highlight'><pre>    debuild -us -uc;</pre></div>
        
      
        
        <p>We now have to remove the debian directory, the tarballs, and some files
created by <em>debuild</em>.</p>

        
          <div class='highlight'><pre>    rm -rf debian/ &amp;&amp; <span class="hljs-built_in">cd</span> ..;
    rm <span class="hljs-operator">-f</span> <span class="hljs-string">"<span class="hljs-variable">$BINTARBALL</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$LIBTARBALL</span>"</span>;
    rm <span class="hljs-operator">-f</span> <span class="hljs-string">"<span class="hljs-variable">$LIBPACKAGENAME</span>"</span><span class="hljs-string">"_<span class="hljs-variable">$VERSION</span>.debian.tar.gz"</span>;
    rm <span class="hljs-operator">-f</span> <span class="hljs-string">"<span class="hljs-variable">$LIBPACKAGENAME</span>"</span><span class="hljs-string">"_<span class="hljs-variable">$VERSION</span>.dsc"</span>;
    rm <span class="hljs-operator">-f</span> *.build *.changes;</pre></div>
        
      
        
        <p>If the user wanted to create both type of packages, we can exit the script
because we’ve done that.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> [ ! -z <span class="hljs-variable">$BINTARBALL</span> ]
    <span class="hljs-keyword">then</span>
	<span class="hljs-keyword">exit</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">fi</span></pre></div>
        
      
        
        <h2 id="-a-id-bin-building-the-binary-package-a-"><a id'=bin'>Building the binary package</a></h2>

        
      
        
        
        
          <div class='highlight'><pre><span class="hljs-keyword">elif</span> [ ! -z <span class="hljs-variable">$BINTARBALL</span> ] 
<span class="hljs-keyword">then</span></pre></div>
        
      
        
        <h2 id="-a-id-bindeb-creation-of-the-debian-files-a-"><a id='bindeb'>Creation of the debian files</a></h2>

        
      
        
        
        
      
        
        <p>In this part of the script, we create the files that <em>debuild</em> needs to build
the package. We do exactly the same things as above, so you should read that
part of the script.</p>

        
      
        
        <p>Removing the debian directory, if it exists</p>

        
          <div class='highlight'><pre>    rm -rf debian/</pre></div>
        
      
        
        <p>Creation of the debian files 
The only difference between this call to <em>dh_make</em> and the one above is
the -s option. This option tells <em>dh_make</em> that we want to create a binary
package.</p>

        
          <div class='highlight'><pre>
    env <span class="hljs-built_in">echo</span> <span class="hljs-operator">-e</span> -n <span class="hljs-string">"\n"</span> &gt;debtmpfile
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$COPYRIGHTTYPE</span> = <span class="hljs-string">"predefined"</span> ]
    <span class="hljs-keyword">then</span>
	dh_make <span class="hljs-operator">-s</span> -c <span class="hljs-variable">$COPYRIGHT</span> -p <span class="hljs-string">"<span class="hljs-variable">$BINPACKAGENAME</span>"</span><span class="hljs-string">"_<span class="hljs-variable">$VERSION</span>"</span> &lt; debtmpfile
    <span class="hljs-keyword">else</span>
	dh_make <span class="hljs-operator">-s</span> -p <span class="hljs-string">"<span class="hljs-variable">$BINPACKAGENAME</span>"</span><span class="hljs-string">"_<span class="hljs-variable">$VERSION</span>"</span> &lt; debtmpfile
    <span class="hljs-keyword">fi</span></pre></div>
        
      
        
        <p>Copying the copyright file, if there is one</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$COPYRIGHTTYPE</span> = <span class="hljs-string">"file"</span> ] 
    <span class="hljs-keyword">then</span>
	cp <span class="hljs-variable">$COPYRIGHT</span> debian/copyright
    <span class="hljs-keyword">fi</span>

    rm <span class="hljs-operator">-f</span> debtmpfile</pre></div>
        
      
        
        <h2 id="-a-id-debmod-modification-of-the-debian-files-a-"><a id='debmod'>Modification of the debian files</a></h2>

        
      
        
        
        
      
        
        <p>Modifying the changelog file</p>

        
          <div class='highlight'><pre>
    perl -pi <span class="hljs-operator">-e</span> <span class="hljs-string">'s/\(((\d+\.?)+)-\d+\)/($1)/'</span> debian/changelog</pre></div>
        
      
        
        <p>Removing useless files</p>

        
          <div class='highlight'><pre>
    rm -rf debian/*.EX debian/*.ex debian/README*</pre></div>
        
      
        
        <p>Creating .install file</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">for</span> binary <span class="hljs-keyword">in</span> <span class="hljs-variable">$BINARYNAMES</span>
    <span class="hljs-keyword">do</span>
	<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$binary</span> usr/bin"</span> &gt;&gt; debian/<span class="hljs-variable">$BINPACKAGENAME</span>.install
    <span class="hljs-keyword">done</span>;</pre></div>
        
      
        
        <p>Creating .dirs file</p>

        
          <div class='highlight'><pre>    <span class="hljs-built_in">echo</span> <span class="hljs-string">"usr/bin"</span> &gt;&gt; debian/<span class="hljs-variable">$BINPACKAGENAME</span>.dirs</pre></div>
        
      
        
        <p>Adding dependencies, if there are any</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> [ ! -z <span class="hljs-variable">$PACKAGEDEPENDS</span> ]
    <span class="hljs-keyword">then</span>
	perl -pi <span class="hljs-operator">-e</span> <span class="hljs-string">'s/^(Depends:.+)$/$1, '</span><span class="hljs-string">"<span class="hljs-variable">$PACKAGEDEPENDS</span>/"</span> debian/control 
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ ! -z <span class="hljs-variable">$BUILDDEPENDS</span> ]
    <span class="hljs-keyword">then</span>
	perl -pi <span class="hljs-operator">-e</span> <span class="hljs-string">'s/^(Build-Depends:.+)$/$1, '</span><span class="hljs-string">"<span class="hljs-variable">$BUILDDEPENDS</span>/"</span> debian/control
    <span class="hljs-keyword">fi</span></pre></div>
        
      
        
        <h2 id="-a-id-binsource-creation-of-the-source-package-a-"><a id='binsource'>Creation of the source package</a></h2>

        
      
        
        
        
      
        
        <p>We build the source package, and then we correct some of the mistakes
that _lintian_detected</p>

        
          <div class='highlight'><pre>    debuild -S -uc -us
    ../correct_lintian.pl  ../<span class="hljs-string">"<span class="hljs-variable">$BINPACKAGENAME</span>"</span><span class="hljs-string">"_<span class="hljs-variable">$VERSION</span>"</span><span class="hljs-string">"_source.build"</span></pre></div>
        
      
        
        <h2 id="-a-id-libbuild-building-the-package-a-"><a id='libbuild'>Building the package</a></h2>

        
      
        
        
        
      
        
        <p>Building the package</p>

        
          <div class='highlight'><pre>    debuild -us -uc;</pre></div>
        
      
        
        <p>Removing useless files</p>

        
          <div class='highlight'><pre>    rm -rf debian/ &amp;&amp; <span class="hljs-built_in">cd</span> ..;
    rm <span class="hljs-operator">-f</span> <span class="hljs-string">"<span class="hljs-variable">$BINTARBALL</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$LIBTARBALL</span>"</span>;
    rm <span class="hljs-operator">-f</span> <span class="hljs-string">"<span class="hljs-variable">$BINPACKAGENAME</span>"</span><span class="hljs-string">"_<span class="hljs-variable">$VERSION</span>.debian.tar.gz"</span>;
    rm <span class="hljs-operator">-f</span> <span class="hljs-string">"<span class="hljs-variable">$BINPACKAGENAME</span>"</span><span class="hljs-string">"_<span class="hljs-variable">$VERSION</span>.dsc"</span>;
    rm <span class="hljs-operator">-f</span> *.build *.changes;
<span class="hljs-keyword">fi</span></pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
